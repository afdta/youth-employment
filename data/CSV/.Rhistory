feed <- read.csv("/home/alec/Dropbox/Projects/metro-innovations/feed/2015_08_07.csv",stringsAsFactors = FALSE)
feed <- read.csv("/home/alec/Projects/Brookings/DataViz/metro-innovations/feed/2015_08_07.csv",stringsAsFactors = FALSE)
notes <- feed$notes
firstFuzzy <- function(query, candidates){
q <- gsub("-|( and )","|",query)
if(q=="NE Ohio"){
q<-"Cleveland"
} else if(q=="MSP"){
q<-"Minneapolis"
}
i <- grep(q, candidates)
if(length(i)==1){
val <- candidates[i]
} else if(length(i)>1){
val <- candidates[i[1]]
} else{
val <- NA
}
return(data.frame(query=query, CBSA_Title=val))
}
can <- pops$CBSA_Title
l<-lapply(notes, firstFuzzy, can)
#lapply
mtch <- do.call(rbind, l)
View(mtch)
notes
firstFuzzy <- function(query, candidates){
q <- gsub("-|( and )","|",query)
q <- gsub("^ *| *$","",query)
if(q=="NE Ohio"){
q<-"Cleveland"
} else if(q=="MSP"){
q<-"Minneapolis"
}
i <- grep(q, candidates)
if(length(i)==1){
val <- candidates[i]
} else if(length(i)>1){
val <- candidates[i[1]]
} else{
val <- NA
}
return(data.frame(query=query, CBSA_Title=val))
}
can <- pops$CBSA_Title
l<-lapply(notes, firstFuzzy, can)
#lapply
mtch <- do.call(rbind, l)
View(mtch)
firstFuzzy <- function(query, candidates){
q <- gsub("-|( and )","|",query)
q <- gsub("^ *| *$","",query)
print(q)
if(q=="NE Ohio"){
q<-"Cleveland"
} else if(q=="MSP"){
q<-"Minneapolis"
}
i <- grep(q, candidates)
if(length(i)==1){
val <- candidates[i]
} else if(length(i)>1){
val <- candidates[i[1]]
} else{
val <- NA
}
return(data.frame(query=query, CBSA_Title=val))
}
can <- pops$CBSA_Title
l<-lapply(notes, firstFuzzy, can)
firstFuzzy <- function(query, candidates){
q <- gsub("-|( and )","|",query)
q <- gsub("^ *| *$","",q)
print(q)
if(q=="NE Ohio"){
q<-"Cleveland"
} else if(q=="MSP"){
q<-"Minneapolis"
}
i <- grep(q, candidates)
if(length(i)==1){
val <- candidates[i]
} else if(length(i)>1){
val <- candidates[i[1]]
} else{
val <- NA
}
return(data.frame(query=query, CBSA_Title=val))
}
can <- pops$CBSA_Title
l<-lapply(notes, firstFuzzy, can)
mtch <- do.call(rbind, l)
idx <- merge(pops[c("CBSA_Title","CBSA_Code")], mtch, by="CBSA_Title")
View(idx)
View(feed)
View(idx)
feed2 <- feed
match(feed$notes,idx$query)
View(feed)
View(idx)
feed2 <- feed
pos <- match(feed$notes,idx$query)
feed2$metro_code <- idx[pos,"CBSA_Code"]
feed2$metro_name <- idx[pos,"CBSA_Title"]
View(feed2)
write.csv(feed2, file="/home/alec/Projects/Brookings/DataViz/metro-innovations/feed/2015_09_24.csv")
write.csv(feed2, file="/home/alec/Projects/Brookings/DataViz/metro-innovations/feed/2015_09_24.csv", col.names=TRUE, row.names=FALSE)
write.csv(feed2, file="/home/alec/Projects/Brookings/DataViz/metro-innovations/feed/2015_09_24.csv", row.names=FALSE)
q()
library("metromonitor")
pops <- metropops(t100 = FALSE, vintage="2013")
pops
View(pops)
install.packages("RCurl")
?download.file
library("metromonitor")
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL",
"GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD",
"MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM",
"NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN",
"TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
states
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
states
?match.arg
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode")){
arg <- match.arg(geo)
print(arg)
}
get_check(cong)
get_check("cong")
get_check("congress")
get_check("congssssss")
getwd()
getwd()
checker <- function(csv){
cv <- read.csv(csv)
print(cv[1,])
}
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",suffix))
checker(paste0(dir,"/",s))
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",suffix), paste0(dir,"/",s))
checker(paste0(dir,"/",s))
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
url
url <- "http://www.brookings.edu/~/media/multimedia/interactives/2013/EITC"
get_check("metro", url, "~/Desktop/Temp", checker)
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",arg,"/",suffix), paste0(dir,"/",s))
checker(paste0(dir,"/",s))
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
checker <- function(csv){
cv <- read.csv(csv)
print(names(cv))
}
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",arg,"/",suffix), paste0(dir,"/",s))
checker(paste0(dir,"/",s))
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
checker <- function(csv){
cv <- read.csv(csv)
print(ncol(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
checker <- function(csv){
cv <- read.csv(csv)
print(ncol(cv))
print(names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
checker <- function(csv){
cv <- read.csv(csv)
print("tnew13" %in% names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
results <- list()
a <- list(a=1,b=2)
a[1]
a[1] <- 25
a
a[[1]] <- 25
a
a[[1]] <- 29
a
a<-data.frame(a=1:10,b=11:20)
a
a[1]<-5:10
a[1]<-5:9
a
a<- list(a=1:10, b=11:20)
a
a[1] <- 1:5
a[1] <- list(1:5)
a
list(1:5)
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[len+1] <- list(newfile=tnew, names=names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[(len+1)] <- list(newfile=tnew, names=names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
a<- list()
list[1+1] <- list(a=1:10, b=1:5)
a[1+1] <- list(a=1:10, b=1:5)
a[(1+1)] <- list(a=1:10, b=1:5)
a[1] <- 1:5
a<- list(1,2)
a
a[(1+1)] <- list(a=1:10, b=1:5)
a[1+1]
a
a<- list(a=1,b=2,c=3,d=4)
a
a[1] <- list(a=1,b=2)
a
a[1] <- list(a=10,b=2)
a
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <- list(newfile=tnew, names=names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <- list(newfile=tnew, names=names(cv))
print(results)
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
test[[1]] <- 25
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, names=names(cv))
print(results)
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
url <- "http://www.brookings.edu/~/media/multimedia/interactives/2013/EITC"
results <- list()
checker <- function(csv, geo){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, geo, names=names(cv))
}
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",arg,"/",suffix), paste0(dir,"/",s))
checker(paste0(dir,"/",s), arg)
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
results <- list()
checker <- function(csv, geo){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, geo=geo, names=names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
results <- list()
checker <- function(csv, geo){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, geo=geo, names=names(cv))
}
results
get_check("city", url, "~/Desktop/Temp", checker)
results <- list()
checker <- function(csv, geo){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, geo=geo, names=names(cv))
}
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
file_names <- paste0(arg,suffix,"_TY13.csv")
for(f in file_names){
download.file(paste0(base_url,"/",arg,"/",f), paste0(dir,"/",f))
checker(paste0(dir,"/",f), arg)
}
}
get_check("city", url, "~/Desktop/Temp", checker)
trues <- sapply(results, function(e){return e$tnew})
trues <- sapply(results, function(e){return(e$tnew)})
sum(trues)
trues
trues <- sapply(results, function(e){return(e$newfile)})
trues
sum(TRUE)
sum(trues)
results[1]
get_check("congress", url, "~/Desktop/Temp", checker)
get_check("county", url, "~/Desktop/Temp", checker)
get_check("house", url, "~/Desktop/Temp", checker)
get_check("metro", url, "~/Desktop/Temp", checker)
get_check("senate", url, "~/Desktop/Temp", checker)
get_check("state", url, "~/Desktop/Temp", checker)
get_check("zipcode", url, "~/Desktop/Temp", checker)
"tnew13" %in% c("TNEW13", "Tnew13","tnew1")
"tnew13" %in% c("TNEW13", "Tnew13","tnew11")
"tnew13" %in% c("TNEW13", "Tnew13","tnew13")
trues <- sapply(results, function(e){return(e$newfile)})
trues
sum(trues)
geos <- sapply(results, function(e){return(e$geo)})
trues <- sapply(results, function(e){return(e$newfile)})
geos <- sapply(results, function(e){return(e$geo)})
table(trues,geos)
table(1:10,c(1:5,1:5))
q()
library("metromonitor")
q()
freyseg <- read.csv("~/Projects/quick-map/segregation-map/data/FreySegregationMap.csv", stringsAsFactors=FALSE)
freyseg <- read.csv("~/Projects/Mapping/quick-map/segregation-map/data/FreySegregationMap.csv", stringsAsFactors=FALSE)
View(freyseg)
p + geom_dotplot(aes(x=Index))
p <- ggplot(freyseg)
p + geom_dotplot(aes(x=Index))
library(ggplot2)
library(ggplot2)
library("ggplot2", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
q()
freyseg <- read.csv("~/Projects/Mapping/quick-map/segregation-map/data/FreySegregationMap.csv", stringsAsFactors=FALSE)
library(metromonitor)
library(ggplot2)
install.packages("stringi")
library(metromonitor)
library(ggplot2)
p <- ggplot(freyseg)
p + geom_dotplot(aes(x=Index))
p + geom_dotplot(aes(x=Index), binwidth=10)
p + geom_dotplot(aes(x=Index), binwidth=10)
p + geom_dotplot(aes(x=Index), binwidth=10,dotsize=0.25)
p + geom_dotplot(aes(x=Index), binwidth=6,dotsize=0.25)
p + geom_dotplot(aes(x=Index), binwidth=8,dotsize=0.25)
p + geom_dotplot(aes(x=Index), binwidth=7,dotsize=0.25)
p + geom_point(aes(x=Group, y=Index, size=Index))
library(metromonitor)
mp <- metropops(TRUE, "2013")[c("CBSA_Code","CBSA_Title")]
View(mp)
I <- read.csv("~/Dropbox/Projects/Brookings/DataViz/metro-innovations/feed/2015_11_23.csv")
N <- read.csv("~/Dropbox/Projects/Brookings/DataViz/metro-innovations/feed/2015_12_08.csv")
?identical
all.equal(I, N)
I2 <- do.call(paste, I)
N2 <- do.call(paste, N)
which(I2 != N2)
nomatch <- which(I2 != N2)
I[nomatch,]
N[nomatch,]
all.equal(
I[nomatch,],
N[nomatch,]
)
q()
q()
library("metromonitor")
contributors()
setwd("~/Projects/Brookings/DataViz/YouthEmployment/data/")
setwd("~/Projects/Brookings/DataViz/YouthEmployment/data/CSV/")
files <- list.files()
files
?as.environment
read_all_in <- function(){
files <- list.files()
print(files)
}
read_all_in()
read_all_in <- function(){
files <- list.files()
for(f in files){
csv <- read.csv(f, na.strings=c(""," "))
}
}
read_all_in()
search()
read_all_in <- function(){
files <- list.files()
print(search())
for(f in files){
csv <- read.csv(f, na.strings=c(""," "))
}
}
read_all_in()
sub("\.csv","","Test.csv")
sub("\\.csv","","Test.csv")
assign(sub("\\.csv","",f), read.csv(f, na.strings=c(""," ")))
for(f in files){
csv <- read.csv(f, na.strings=c(""," "))
assign(sub("\\.csv","",f), csv)
}
files
all.equal(csv, UR_Sex)
?rm
rm(list=c("f","csv"))
rm(list=ls())
setwd("~/Projects/Brookings/DataViz/YouthEmployment/data/CSV/")
for(f in list.files()){
csv <- read.csv(f, na.strings=c(""," "))
assign(sub("\\.csv","",f), csv)
}
rm(list=c("f","csv"))
View(ER_Edu)
View(ER_Edu)
library("reshape2")
rm(lis=ls())
rm(list=ls())
for(f in list.files()){
csv <- read.csv(f, na.strings=c(""," "))
assign(sub("\\.csv","",f), read.csv(f, na.strings=c(""," ")) )
}
rm(list=ls())
library("reshape2")
setwd("~/Projects/Brookings/DataViz/YouthEmployment/data/CSV/")
for(f in list.files()){
assign(sub("\\.csv","",f), read.csv(f, na.strings=c(""," ")) )
}
rm(list=c("f"))
View(ER_Edu)
