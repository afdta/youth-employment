q<-"Cleveland"
} else if(q=="MSP"){
q<-"Minneapolis"
}
i <- grep(q, candidates)
if(length(i)==1){
val <- candidates[i]
} else if(length(i)>1){
val <- candidates[i[1]]
} else{
val <- NA
}
return(data.frame(query=query, CBSA_Title=val))
}
can <- pops$CBSA_Title
l<-lapply(notes, firstFuzzy, can)
#lapply
mtch <- do.call(rbind, l)
View(mtch)
notes
firstFuzzy <- function(query, candidates){
q <- gsub("-|( and )","|",query)
q <- gsub("^ *| *$","",query)
if(q=="NE Ohio"){
q<-"Cleveland"
} else if(q=="MSP"){
q<-"Minneapolis"
}
i <- grep(q, candidates)
if(length(i)==1){
val <- candidates[i]
} else if(length(i)>1){
val <- candidates[i[1]]
} else{
val <- NA
}
return(data.frame(query=query, CBSA_Title=val))
}
can <- pops$CBSA_Title
l<-lapply(notes, firstFuzzy, can)
#lapply
mtch <- do.call(rbind, l)
View(mtch)
firstFuzzy <- function(query, candidates){
q <- gsub("-|( and )","|",query)
q <- gsub("^ *| *$","",query)
print(q)
if(q=="NE Ohio"){
q<-"Cleveland"
} else if(q=="MSP"){
q<-"Minneapolis"
}
i <- grep(q, candidates)
if(length(i)==1){
val <- candidates[i]
} else if(length(i)>1){
val <- candidates[i[1]]
} else{
val <- NA
}
return(data.frame(query=query, CBSA_Title=val))
}
can <- pops$CBSA_Title
l<-lapply(notes, firstFuzzy, can)
firstFuzzy <- function(query, candidates){
q <- gsub("-|( and )","|",query)
q <- gsub("^ *| *$","",q)
print(q)
if(q=="NE Ohio"){
q<-"Cleveland"
} else if(q=="MSP"){
q<-"Minneapolis"
}
i <- grep(q, candidates)
if(length(i)==1){
val <- candidates[i]
} else if(length(i)>1){
val <- candidates[i[1]]
} else{
val <- NA
}
return(data.frame(query=query, CBSA_Title=val))
}
can <- pops$CBSA_Title
l<-lapply(notes, firstFuzzy, can)
mtch <- do.call(rbind, l)
idx <- merge(pops[c("CBSA_Title","CBSA_Code")], mtch, by="CBSA_Title")
View(idx)
View(feed)
View(idx)
feed2 <- feed
match(feed$notes,idx$query)
View(feed)
View(idx)
feed2 <- feed
pos <- match(feed$notes,idx$query)
feed2$metro_code <- idx[pos,"CBSA_Code"]
feed2$metro_name <- idx[pos,"CBSA_Title"]
View(feed2)
write.csv(feed2, file="/home/alec/Projects/Brookings/DataViz/metro-innovations/feed/2015_09_24.csv")
write.csv(feed2, file="/home/alec/Projects/Brookings/DataViz/metro-innovations/feed/2015_09_24.csv", col.names=TRUE, row.names=FALSE)
write.csv(feed2, file="/home/alec/Projects/Brookings/DataViz/metro-innovations/feed/2015_09_24.csv", row.names=FALSE)
q()
library("metromonitor")
pops <- metropops(t100 = FALSE, vintage="2013")
pops
View(pops)
install.packages("RCurl")
?download.file
library("metromonitor")
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL",
"GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD",
"MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM",
"NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN",
"TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
states
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
states
?match.arg
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode")){
arg <- match.arg(geo)
print(arg)
}
get_check(cong)
get_check("cong")
get_check("congress")
get_check("congssssss")
getwd()
getwd()
checker <- function(csv){
cv <- read.csv(csv)
print(cv[1,])
}
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",suffix))
checker(paste0(dir,"/",s))
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",suffix), paste0(dir,"/",s))
checker(paste0(dir,"/",s))
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
url
url <- "http://www.brookings.edu/~/media/multimedia/interactives/2013/EITC"
get_check("metro", url, "~/Desktop/Temp", checker)
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",arg,"/",suffix), paste0(dir,"/",s))
checker(paste0(dir,"/",s))
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
checker <- function(csv){
cv <- read.csv(csv)
print(names(cv))
}
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",arg,"/",suffix), paste0(dir,"/",s))
checker(paste0(dir,"/",s))
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
checker <- function(csv){
cv <- read.csv(csv)
print(ncol(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
checker <- function(csv){
cv <- read.csv(csv)
print(ncol(cv))
print(names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
checker <- function(csv){
cv <- read.csv(csv)
print("tnew13" %in% names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
results <- list()
a <- list(a=1,b=2)
a[1]
a[1] <- 25
a
a[[1]] <- 25
a
a[[1]] <- 29
a
a<-data.frame(a=1:10,b=11:20)
a
a[1]<-5:10
a[1]<-5:9
a
a<- list(a=1:10, b=11:20)
a
a[1] <- 1:5
a[1] <- list(1:5)
a
list(1:5)
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[len+1] <- list(newfile=tnew, names=names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[(len+1)] <- list(newfile=tnew, names=names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
a<- list()
list[1+1] <- list(a=1:10, b=1:5)
a[1+1] <- list(a=1:10, b=1:5)
a[(1+1)] <- list(a=1:10, b=1:5)
a[1] <- 1:5
a<- list(1,2)
a
a[(1+1)] <- list(a=1:10, b=1:5)
a[1+1]
a
a<- list(a=1,b=2,c=3,d=4)
a
a[1] <- list(a=1,b=2)
a
a[1] <- list(a=10,b=2)
a
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <- list(newfile=tnew, names=names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <- list(newfile=tnew, names=names(cv))
print(results)
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
test[[1]] <- 25
results <- list()
checker <- function(csv){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, names=names(cv))
print(results)
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
url <- "http://www.brookings.edu/~/media/multimedia/interactives/2013/EITC"
results <- list()
checker <- function(csv, geo){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, geo, names=names(cv))
}
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
suffix <- paste0(arg,suffix,"_TY13.csv")
for(s in suffix){
download.file(paste0(base_url,"/",arg,"/",suffix), paste0(dir,"/",s))
checker(paste0(dir,"/",s), arg)
}
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
results <- list()
checker <- function(csv, geo){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, geo=geo, names=names(cv))
}
get_check("metro", url, "~/Desktop/Temp", checker)
results
results <- list()
checker <- function(csv, geo){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, geo=geo, names=names(cv))
}
results
get_check("city", url, "~/Desktop/Temp", checker)
results <- list()
checker <- function(csv, geo){
cv <- read.csv(csv)
len <- length(results)
tnew <- "tnew13" %in% names(cv)
results[[(len+1)]] <<- list(newfile=tnew, geo=geo, names=names(cv))
}
get_check <- function(geo = c("city", "congress", "county", "house", "metro", "senate", "state", "zipcode"), base_url, dir=getwd(), checker){
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
arg <- match.arg(geo)
print(paste("Checking", arg, ". Using the directory", dir, "to conduct business."))
if(arg %in% c("metro", "state")){
suffix <- c("")
} else{
suffix <- c(states, "")
}
file_names <- paste0(arg,suffix,"_TY13.csv")
for(f in file_names){
download.file(paste0(base_url,"/",arg,"/",f), paste0(dir,"/",f))
checker(paste0(dir,"/",f), arg)
}
}
get_check("city", url, "~/Desktop/Temp", checker)
trues <- sapply(results, function(e){return e$tnew})
trues <- sapply(results, function(e){return(e$tnew)})
sum(trues)
trues
trues <- sapply(results, function(e){return(e$newfile)})
trues
sum(TRUE)
sum(trues)
results[1]
get_check("congress", url, "~/Desktop/Temp", checker)
get_check("county", url, "~/Desktop/Temp", checker)
get_check("house", url, "~/Desktop/Temp", checker)
get_check("metro", url, "~/Desktop/Temp", checker)
get_check("senate", url, "~/Desktop/Temp", checker)
get_check("state", url, "~/Desktop/Temp", checker)
get_check("zipcode", url, "~/Desktop/Temp", checker)
"tnew13" %in% c("TNEW13", "Tnew13","tnew1")
"tnew13" %in% c("TNEW13", "Tnew13","tnew11")
"tnew13" %in% c("TNEW13", "Tnew13","tnew13")
trues <- sapply(results, function(e){return(e$newfile)})
trues
sum(trues)
geos <- sapply(results, function(e){return(e$geo)})
trues <- sapply(results, function(e){return(e$newfile)})
geos <- sapply(results, function(e){return(e$geo)})
table(trues,geos)
table(1:10,c(1:5,1:5))
q()
library("metromonitor")
q()
freyseg <- read.csv("~/Projects/quick-map/segregation-map/data/FreySegregationMap.csv", stringsAsFactors=FALSE)
freyseg <- read.csv("~/Projects/Mapping/quick-map/segregation-map/data/FreySegregationMap.csv", stringsAsFactors=FALSE)
View(freyseg)
p + geom_dotplot(aes(x=Index))
p <- ggplot(freyseg)
p + geom_dotplot(aes(x=Index))
library(ggplot2)
library(ggplot2)
library("ggplot2", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
q()
freyseg <- read.csv("~/Projects/Mapping/quick-map/segregation-map/data/FreySegregationMap.csv", stringsAsFactors=FALSE)
library(metromonitor)
library(ggplot2)
install.packages("stringi")
library(metromonitor)
library(ggplot2)
p <- ggplot(freyseg)
p + geom_dotplot(aes(x=Index))
p + geom_dotplot(aes(x=Index), binwidth=10)
p + geom_dotplot(aes(x=Index), binwidth=10)
p + geom_dotplot(aes(x=Index), binwidth=10,dotsize=0.25)
p + geom_dotplot(aes(x=Index), binwidth=6,dotsize=0.25)
p + geom_dotplot(aes(x=Index), binwidth=8,dotsize=0.25)
p + geom_dotplot(aes(x=Index), binwidth=7,dotsize=0.25)
p + geom_point(aes(x=Group, y=Index, size=Index))
library(metromonitor)
mp <- metropops(TRUE, "2013")[c("CBSA_Code","CBSA_Title")]
View(mp)
I <- read.csv("~/Dropbox/Projects/Brookings/DataViz/metro-innovations/feed/2015_11_23.csv")
N <- read.csv("~/Dropbox/Projects/Brookings/DataViz/metro-innovations/feed/2015_12_08.csv")
?identical
all.equal(I, N)
I2 <- do.call(paste, I)
N2 <- do.call(paste, N)
which(I2 != N2)
nomatch <- which(I2 != N2)
I[nomatch,]
N[nomatch,]
all.equal(
I[nomatch,],
N[nomatch,]
)
q()
q()
library("metromonitor")
contributors()
#to do: test the geo codes here
library("reshape2")
setwd("~/Projects/Brookings/DataViz/youth-employment/data/CSV/")
for(f in list.files()){
assign(sub("\\.csv","",f), read.csv(f, na.strings=c(""," "), stringsAsFactors=FALSE) )
}
rm(list=c("f"))
lv <- function(df){
nm <- names(df)
nl <- ""
s <- paste("(", 1:length(nm),")...", nm, sep="",collapse="\n")
cat(s)
}
#store final processed data in
dy <- list()
er <- list()
ur <- list()
#slim down the DY data
dy$char_edu <- DY_Char_Edu[,c(1,3,5,10,12,17,19,24,26,31:37)]
dy$char_nativity <- DY_Char_Nativity[,c(1,3,5,10,12,17,19,24:28)]
dy$char_race <- DY_Char_Race[,c(1,3,5,10,12,17,19,24,26,31,33,38,40,45,46:55)]
dy$char_sex <- DY_Char_Sex[,c(1,3,5,10,12,17,19,24,25,26)]
dy$nativity <- DY_Nativity[,c(1,3,5,7,12,14,19,20,21)]
dy$race <- DY_Race[,c(1,3,5,7,12,14,19,20,21)]
dy$sex <- DY_Sex[,c(1,3,5,7,12,14,19,20,21)]
dy$overall <- DY_Overall[,c(1,3,5,10,12,17,18,19)]
#slim down the ER data
er$edu <- ER_Edu[,c(1,2,4,13,7,12,15,20,21,22)]
er$race <- ER_Race[,c(1,2,4,13,7,12,15,20,21,22)]
er$sex <- ER_Sex[,c(1,2,4,13,7,12,15,20,21,22)]
er$overall <- ER_Overall[,c(1,2,4,6,11,13,18,19,20)]
#slim down the UR data
ur$edu <- UR_Edu[,c(1,2,4,13,7,12,15,20,21,22)]
ur$race <- UR_Race[,c(1,2,4,13,7,12,15,20,21,22)]
ur$sex <- UR_Sex[,c(1,2,4,13,7,12,15,20,21,22)]
ur$overall <- UR_Overall[,c(1,2,4,6,11,13,18,19,20)]
#make rectangular -- import strings not as factors
er$edu[,c("re_label","sex_label")] <- list(a="All",b="All")
er$race[,c("ed_label","sex_label")] <- list(a="All",b="All")
er$sex[,c("ed_label","re_label")] <- list(a="All",b="All")
er$overall[,c("ed_label","sex_label","re_label")] <- list(a="All",b="All",c="All")
er$all <- rbind(er$edu,er$race,er$sex,er$overall)
ur$edu[,c("re_label","sex_label")] <- list(a="All",b="All")
ur$race[,c("ed_label","sex_label")] <- list(a="All",b="All")
ur$sex[,c("ed_label","re_label")] <- list(a="All",b="All")
ur$overall[,c("ed_label","sex_label","re_label")] <- list(a="All",b="All",c="All")
ur$all <- rbind(ur$edu,ur$race,ur$sex,ur$overall)
head(dy$nativity)
head(dy$race)
head(dy$sex)
head(dy$overall)
dy$nativity[,c("re_label","sex_label",)] <- list(a="All",b="All")
dy$nativity[,c("re_label","sex_label")] <- list(a="All",b="All")
dy$race[,c("fb_label","sex_label")] <- list(a="All",b="All")
dy$sex[,c("re_label","fb_label")] <- list(a="All",b="All")
dy$overall[,c("re_label","sex_label","fb_label")] <- list(a="All",b="All",c="All")
dy$all <- rbind(dy$overall, dy$nativity, dy$race, dy$sex)
names(dy$char_nativity)
names(dy$char_edu)
names(dy$char_race)
names(dy$char_sex)
head(ur$edu)
sapply(ur, nrow)
sapply(ur, function(e){with(e, table(YEAR))})
lapply(ur, function(e){with(e, table(YEAR))})
Akron <- ur$sex[ur$sex$Assigned_CBSA==10420,]
Akron
